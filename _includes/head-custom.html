<!-- Favicon is automatically handled by Just the Docs theme via favicon_ico in _config.yml -->

<!-- Custom CSS for Mermaid diagram interactions -->
<style>
/* Diagram container with expand button - expand to fit content, allow scroll */
.mermaid-container {
  position: relative;
  margin: 1rem 0;
  width: fit-content !important; /* Expand to fit diagram */
  min-width: 100% !important; /* At least full container width */
  max-width: none !important;
  overflow-x: auto; /* Scrollbar when content overflows */
  overflow-y: visible;
  display: flex;
  justify-content: center; /* Center the diagram */
}

/* Expand/fullscreen button */
.mermaid-expand-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  z-index: 10;
  background: rgba(45, 45, 45, 0.9);
  border: 1px solid #5C2D91;
  border-radius: 4px;
  color: #fff;
  padding: 6px 12px;
  font-size: 12px;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.mermaid-container:hover .mermaid-expand-btn {
  opacity: 1;
}

.mermaid-expand-btn:hover {
  background: #5C2D91;
}

/* Fullscreen modal overlay */
.mermaid-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.95);
  z-index: 9999;
  overflow: auto;
  padding: 20px;
  box-sizing: border-box;
}

.mermaid-modal.active {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}

.mermaid-modal-content {
  max-width: 95vw;
  max-height: 90vh;
  overflow: auto;
  background: #1e1e1e;
  border-radius: 8px;
  padding: 20px;
}

.mermaid-modal-content svg {
  max-width: none !important;
  width: auto !important;
  height: auto !important;
  min-width: 100%;
}

.mermaid-modal-close {
  position: fixed;
  top: 20px;
  right: 30px;
  background: #D83B01;
  border: none;
  border-radius: 4px;
  color: #fff;
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
  z-index: 10000;
}

.mermaid-modal-close:hover {
  background: #ff4d1f;
}

/* Zoom controls in modal */
.mermaid-zoom-controls {
  position: fixed;
  bottom: 20px;
  right: 30px;
  display: flex;
  gap: 10px;
  z-index: 10000;
}

.mermaid-zoom-btn {
  background: rgba(45, 45, 45, 0.9);
  border: 1px solid #5C2D91;
  border-radius: 4px;
  color: #fff;
  padding: 8px 16px;
  font-size: 16px;
  cursor: pointer;
}

.mermaid-zoom-btn:hover {
  background: #5C2D91;
}

/* Edit in Mermaid Live button */
.mermaid-edit-btn {
  position: absolute;
  top: 8px;
  right: 100px;
  z-index: 10;
  background: rgba(45, 45, 45, 0.9);
  border: 1px solid #107C10;
  border-radius: 4px;
  color: #fff;
  padding: 6px 12px;
  font-size: 12px;
  cursor: pointer;
  opacity: 0;
  transition: opacity 0.2s ease;
  text-decoration: none;
}

.mermaid-container:hover .mermaid-edit-btn {
  opacity: 1;
}

.mermaid-edit-btn:hover {
  background: #107C10;
  color: #fff;
  text-decoration: none;
}
</style>

<!-- Mermaid interaction script - runs after Mermaid renders -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Wait for Mermaid to finish rendering
  setTimeout(function() {
    wrapMermaidDiagrams();
  }, 1000);
});

function wrapMermaidDiagrams() {
  const mermaidDivs = document.querySelectorAll('.mermaid');
  
  mermaidDivs.forEach(function(mermaidDiv, index) {
    // Skip if already wrapped
    if (mermaidDiv.parentElement.classList.contains('mermaid-container')) return;
    
    // Get the original mermaid code (stored as data attribute by some renderers)
    // or try to extract from pre > code if available
    let mermaidCode = '';
    const svg = mermaidDiv.querySelector('svg');
    
    // Create wrapper
    const container = document.createElement('div');
    container.className = 'mermaid-container';
    
    // Create expand button
    const expandBtn = document.createElement('button');
    expandBtn.className = 'mermaid-expand-btn';
    expandBtn.textContent = '⛶ Expand';
    expandBtn.onclick = function() {
      openMermaidModal(mermaidDiv.innerHTML);
    };
    
    // Wrap the mermaid div
    mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
    container.appendChild(expandBtn);
    container.appendChild(mermaidDiv);
  });
  
  // Create modal if it doesn't exist
  if (!document.getElementById('mermaid-modal')) {
    const modal = document.createElement('div');
    modal.id = 'mermaid-modal';
    modal.className = 'mermaid-modal';
    modal.innerHTML = `
      <button class="mermaid-modal-close" onclick="closeMermaidModal()">✕ Close</button>
      <div class="mermaid-modal-content" id="mermaid-modal-content"></div>
      <div class="mermaid-zoom-controls">
        <button class="mermaid-zoom-btn" onclick="zoomMermaid(0.8)">−</button>
        <button class="mermaid-zoom-btn" onclick="zoomMermaid(1)">Reset</button>
        <button class="mermaid-zoom-btn" onclick="zoomMermaid(1.25)">+</button>
      </div>
    `;
    document.body.appendChild(modal);
  }
}

let currentZoom = 1;

function openMermaidModal(svgContent) {
  const modal = document.getElementById('mermaid-modal');
  const content = document.getElementById('mermaid-modal-content');
  content.innerHTML = svgContent;
  currentZoom = 1;
  modal.classList.add('active');
  document.body.style.overflow = 'hidden';
  
  // Reset SVG size constraints for modal
  const svg = content.querySelector('svg');
  if (svg) {
    svg.style.maxWidth = 'none';
    svg.style.width = 'auto';
    svg.style.height = 'auto';
  }
}

function closeMermaidModal() {
  const modal = document.getElementById('mermaid-modal');
  modal.classList.remove('active');
  document.body.style.overflow = '';
}

function zoomMermaid(factor) {
  const content = document.getElementById('mermaid-modal-content');
  const svg = content.querySelector('svg');
  if (svg) {
    if (factor === 1) {
      currentZoom = 1;
    } else {
      currentZoom *= factor;
    }
    svg.style.transform = `scale(${currentZoom})`;
    svg.style.transformOrigin = 'top left';
  }
}

// Close modal on Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeMermaidModal();
  }
});
</script>
